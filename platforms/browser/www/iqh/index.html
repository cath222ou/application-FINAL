<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Portail PFNL | SIG</title>

    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    
    <meta name="author" content="Olivier Dupras-Tessier">
    <meta name="copyright" content="(c) 2015-2016 Olivier Dupras-Tessier">
    <meta name="contact" content="olivier.dupras.tessier@gmail.com">
    <meta http-equiv="last-modified" content="2016-04-25@21:45:00 UTC/GMT -4 hours"> 

    <!-- Cordova related JS plateform and plugins -->
    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>  

    <!-- Bootstrap 3.3.5 -->
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css"> 
    <link rel="stylesheet" href="bootstrap/css/bootstrap-responsive.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css"> 
    <!-- Theme style -->
    <link rel="stylesheet" href="dist/css/AdminLTE.min.css">
    <!-- AdminLTE Skins. Choose a skin from the css/skins
         folder instead of downloading all of them to reduce the load. -->
    <link rel="stylesheet" href="dist/css/skins/_all-skins.min.css">
    <!-- DataTables -->
    <link rel="stylesheet" href="plugins/datatables/dataTables.bootstrap.css">    
    <!-- Bootstrap Color Picker -->
    <link rel="stylesheet" href="plugins/colorpicker/bootstrap-colorpicker.min.css">
    <!-- iCheck -->
    <link rel="stylesheet" href="plugins/iCheck/flat/blue.css">
    <link rel="stylesheet" href="plugins/iCheck/line/blue.css">  
    <!-- Date Picker -->
    <link rel="stylesheet" href="plugins/datepicker/datepicker3.css">
    <!-- Daterange picker -->
    <link rel="stylesheet" href="plugins/daterangepicker/daterangepicker-bs3.css">
    <!-- bootstrap wysihtml5 - text editor -->
    <link rel="stylesheet" href="plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css">
    <!-- OL 3 CSS -->
    <!--link rel="stylesheet" href="http://openlayers.org/en/v3.0.0/css/ol.css"-->
    <script> 
      if ( navigator.onLine ) {
        document.write('<link rel="stylesheet" href="http://openlayers.org/en/v3.0.0/css/ol.css">'); 
      } else {
        document.write('<link rel="stylesheet" href="plugins/ol-3.14.0-dist/ol.css">'); 
      }
    </script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <style> 

      #map {
        position: relative; 
        height: 100%; 
        width: 100%;
      }

      #info {
        position: absolute;
        height: 1px;
        width: 1px;
        z-index: 100;
      }
      .info-panel {
        position:absolute; 
        z-index: 1; 
        //background-color: blue; 
      }
      .tooltip.in {
        opacity: 1;
        filter: alpha(opacity=100);
      }
      .tooltip.top .tooltip-arrow {
        border-top-color: white;
      }
      .tooltip-inner {
        border: 2px solid white;
      }

      a.check, a.legend {
        color: inherit;
        opacity: 0.5; 
      }
      a.legend {
        opacity: 0.9; 
      }
      a.check:hover, a.legend:hover {
        opacity: 1;
      }

      .info-text > small {
        color: #777;
      }

      .chart-legend ul { 
        list-style: none; 
      }
      .chart-legend li span{
        display: inline-block;
        width: 12px;
        height: 12px;
        margin-right: 5px;
      } 

      #occupy li {
        display: inline-block; important!
      } 
      #occupy span {
        width: 20px; important!
      }
      #occupy p {
        font-size: 12px; !important
        -webkit-transform: rotate(-45deg); 
        -moz-transform: rotate(-45deg);
        -ms-transform: rotate(-45deg);
        -o-transform: rotate(-45deg);
        transform: rotate(-45deg);
      }

      tr.selected {
        background-color: #c4dcea; !important
      }
      td.dt-center, th.dt-center { 
        text-align: center; 
      }

      h3.row-title {
        color: #3C8DBC;
        border-bottom: 1px solid #3C8DBC;
      }

      span[disabled] { 
        pointer-events: none; 
      }

    </style> 

  </head>
  <body class="hold-transition skin-blue sidebar-mini">
    <div class="wrapper">

      <header class="main-header">
        <!-- Logo -->
        <a href="javascript:" class="logo">
          <!-- mini logo for sidebar mini 50x50 pixels -->
          <span class="logo-mini">PFNL</span>
          <!-- logo for regular state and mobile devices -->
          <span class="logo-lg"><b>Portail</b> PFNL</span>
        </a>
        <!-- Header Navbar: style can be found in header.less -->
        <nav class="navbar navbar-static-top" role="navigation">
          <!-- Sidebar toggle button-->
          <a href="#" class="sidebar-toggle visible-desktop" data-toggle="offcanvas" role="button">
            <span class="sr-only">Toggle navigation</span>
          </a>
          <div class="navbar-custom-menu">
            <ul class="nav navbar-nav">
              <li>
                <a href="javascript:removeInteraction()" class="stop-interaction"><i class="fa fa-times"></i></a>
              </li>

              <!-- User Account: style can be found in dropdown.less -->
              <li class="dropdown user user-menu"  id="logout">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                  <!--i class="glyphicon glyphicon-user"></i-->
                  <img src="dist/img/visual_pharm/user_male.png" class="user-image" alt="User Image" style="background-color: white; border-radius: 50%; ">
                  <span class="hidden-xs"><b> Connexion</b></span>
                </a>
                <ul class="dropdown-menu">
                  <li class="user-header">
                    <span class="fa-stack fa-3x">
                      <i class="fa fa-circle fa-stack-2x" style="color:white;"></i>
                      <i class="fa fa-tree fa-stack-1x" style="color:#3c8dbc;"></i>
                    </span>
                    <p> 
                      Joignez-vous a&#768 nous
                      <small> De&#769butez votre session</small>
                    </p>
                  </li>
                  <!-- Menu Body -->
                  <li class="user-body">
                    <form>
                      <div class="form-group has-feedback">
                        <input type="email" name="email" class="form-control online " placeholder="Adresse courriel">
                        <span class="glyphicon glyphicon-envelope form-control-feedback"></span>
                      </div>
                      <div class="form-group has-feedback">
                        <input type="password" name="password" class="form-control online" placeholder="Mot de passe">
                        <span class="glyphicon glyphicon-lock form-control-feedback"></span>
                      </div>
                    </form> 
                    <div class="row">
                      <div class="col-xs-4 col-xs-offset-8">
                        <button type="button" class="btn btn-primary btn-block btn-flat online" data-toggle="tooltip" data-title="Terminer" onClick="userLogin(this)">
                          <i class="fa fa-sign-in"></i>
                        </button>
                      </div><!-- /.col -->
                    </div>
                  </li>
                  <!-- Menu Footer-->
                  <li class="user-footer online">
                    <a href="pages/register.html" class="text-center" style="color: #C8C8C8; !important"> 
                      <i class="fa fa-users"></i>
                      <span> Devenez membre</span>
                    </a> 
                    <!--a href="#" class="text-center" style="color: #C8C8C8; !important"> 
                      <i class="fa fa-question-circle"></i>
                      <span> Mot de passe oublie&#769</span>
                    </a-->
                  </li>         
                </ul>
              </li>
              <!-- Control Sidebar Toggle Button -->
              <li>
                <a href="#" data-toggle="control-sidebar"><i class="fa fa-sliders"></i></a>
              </li>
            </ul>
          </div>
        </nav>
      </header>
      <!-- Left side column. contains the logo and sidebar -->
      <aside class="main-sidebar">
        <!-- sidebar: style can be found in sidebar.less -->
        <section class="sidebar">
          <div class="user-panel" id="logout" online="true">
            <div class="pull-left image">
              <img src="dist/img/visual_pharm/user_male.png" class="img-circle" alt="User Image" style="background-color:white;">
            </div>
            <div class="pull-left info">
              <p>&nbsp;</p>
              <a href="#"><i class="fa fa-circle text-yellow"></i> De&#769connecte&#769</a>
            </div>
          </div>
          <!-- search form -->
          <form class="sidebar-form" onSubmit="return fn_search( $( 'input#adress' ).val() );">
            <div class="input-group online" id="address">
              <input type="text" id="adress" class="form-control" placeholder="Recherche...">
              <span class="input-group-btn">
                <button type="button" class="btn btn-flat" onClick="fn_search( $( 'input#adress' ).val() )"><i class="fa fa-search"></i></button>
              </span>
            </div>
          </form>
          <!-- /.search form -->
          <!-- sidebar menu: : style can be found in sidebar.less -->
          <ul class="sidebar-menu">
            <li class="header text-center" style="font-variant: small-caps;">Outils et composantes</li>
            <li class="treeview">
              <a href="#">
                <i class="fa fa-wrench"></i> <span> Mesure</span> <i class="fa fa-angle-left pull-right"></i>
              </a>
              <ul class="treeview-menu" id="measure">
                <li name="LineString" onClick="drawFeature(this)"><a href="javascript:"><i class="fa fa-circle-o"></i> Distance</a></li>
                <li name="Polygon" onClick="drawFeature(this)"><a href="javascript:"><i class="fa fa-circle-o"></i> Surface</a></li>
              </ul>
            </li>
          </ul>
        </section>
        <!-- /.sidebar -->
      </aside>

      <!-- Content Wrapper. Contains page content -->
      <div class="content-wrapper">
        <!-- Main row -->
        <div class="row-fluid" id="sig">
          <div class="span12">
            <div class="map" id="map"><div id="info"></div></div><!-- /.map#map -->
		
          </div>
        </div><!-- /. row#sig -->
      </div><!-- /.content-wrapper -->
	  
	
      <footer class="main-footer">
        <div class="pull-right hidden-xs">
          <b>BETA - Version</b> 1.0.3.1
        </div>
        <strong>Copyright &copy; 2015-2016 <a href="https://ca.linkedin.com/in/olivier-dupras-tessier-3a2b8b63" target="_blank">Olivier Dupras-Tessier</a>.</strong> Tous droits re&#769serve&#769s.
      </footer>

      <!-- Control Sidebar -->
      <aside class="control-sidebar control-sidebar-dark">
        <!-- Create the tabs -->
        <ul class="nav nav-tabs nav-justified control-sidebar-tabs">
          <li class="layer active"><a href="#control-sidebar-layers-tab" data-toggle="tab"><i class="fa fa-map-signs"></i></a></li> 
        </ul>
        <!-- Tab panes -->
        <div class="tab-content">
          <!-- Layers tab content -->
          <div class="tab-pane active" id="control-sidebar-layers-tab">

            <!-- search form - For mobile device ONLY-->
            <form class="sidebar-form hidden-desktop" onSubmit="return false">
              <div class="input-group online" id="right-address">
                <input type="text" id="right-adress" class="form-control" placeholder="Recherche...">
                <span class="input-group-btn">
                  <button type="button" class="btn btn-flat" onClick="fn_search( $('input#right-adress').val() )"><i class="fa fa-search"></i></button>
                </span>
              </div>
            </form><!-- For mobile device ONLY -->

            <h3 class="control-sidebar-heading">
              Topographique
              <span class="badge pull-right" style="background-color: #3C8DBC; font-color:#ffffff;">
                <a href="javascript:" class="legend" id="legend" data-toggle="modal" data-target="#legend-graphic" rel="tooltip" title="Le&#769gende">
                  <i class="fa fa-info"></i>
                </a>
              </span>
            </h3> 
            <div class="form-group">
              <input type="checkbox" class="line-layer-selector pull-right" name="nhn:hydrography" onClick="layer2show( this )">
              <label>Réseau hydrographique</label>
              <input type="checkbox" class="line-layer-selector pull-right" name="nrn:roadnetwork" onClick="layer2show( this )">
              <label>Re&#769seau routier</label>
              <input type="checkbox" class="line-layer-selector pull-right" name="aqrp:che_for" onClick="layer2show( this )">
              <label>Chemins forestiers</label>
            </div><!-- /.control-sidebar-menu -->

            <h3 class="control-sidebar-heading">
              The&#769matique
              <a href="#" class="form-reset hidden clear-hsi" style="color:white;" onClick="resetSelectForm( $( 'div.form-group#thematic' ) )">
                <i class="fa fa-fw fa-times pull-right"></i>
              </a>
            </h3>
            <div class="form-group" id="thematic">
              <select class="form-control" id="pfnl" name="PFNL" onchange="bindLayersOption( this )">
                <option style="display:none">PFNL</option>
              </select>
              <select class="form-control" id="espece" parent="pfnl" name="Espe&#768ce" onchange="bindLayersOption( this )">
                <option style="display:none">Espe&#768ce</option>
              </select>
              <select class="form-control" id="iqh" parent="espece" name="IQH" onchange="setLayerGroup( this )">
                <option style="display:none">IQH</option>
              </select>
            </div><!-- /.form-group --> 

            <!-- Doughnut chart element -->
            <h3 class="control-sidebar-heading visible-desktop"> Potentiels de présence</h3>
            <ul class="control-sidebar-menu visible-desktop">
              <li>
                <div class="row">
                  <div class="col-md-6">
                    <div class="chart-legend clearfix" id="js-legend" height="60"></div> 
                  </div>
                  <div class="col-md-6">
                    <div class="chart-responsive">
                      <canvas id="pieChart" width="100" height="60"></canvas>
                    </div><!-- ./chart-responsive --> <!-- / #myChart / --> 
                  </div>
                </div>
              </li>
              <li>
                <div class="chart-legend" id="occupy" height="40">
                  <ul>
                    <li><p>20%</p><span style="background-color:rgba( 254, 229, 217, 0.5 );"></span></li>
                    <li><p>40%</p><span style="background-color:rgba( 252, 174, 145, 0.5 );"></span></li>
                    <li><p>60%</p><span style="background-color:rgba( 251, 106, 74, 0.5 );"></span></li>
                    <li><p>80%</p><span style="background-color:rgba( 222, 45, 38, 0.5 );"></span></li>
                    <li><p>100%</p><span style="background-color:rgba( 165, 15, 21, 0.5 );"></span></li>
                  </ul>
                </div>
              </li>
            </ul>

          </div><!-- /.tab-pane --> 

        </div><!-- /.tab-content --> 
      </aside><!-- /.control-sidebar -->

      <!-- Add the sidebar's background. This div must be placed
           immediately after the control sidebar -->
      <div class="control-sidebar-bg"></div>  

      <!-- Modal - Info messages -->
      <div class="modal fade" id="messages">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              <h4 class="modal-title"> </h4>
            </div>
            <div class="modal-body"> 
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-primary" data-dismiss="modal" data-toggle="tooltip" data-original-title="Terminer"><i class="fa fa-check"></i></button>
            </div>
          </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
      </div><!-- /.modal#marker-group-editor --> 

      <!-- Modal - Export project on local computer -->
      <div class="modal fade" id="publisher-local">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              <h4 class="modal-title"> </h4>
            </div>
            <div class="modal-body"> 
              <form role="form">
                <div class="form-group" id="format">
                  <label> Format du fichier </label>
                  <select class="form-control" name="extension">
                    <option style="display: none;"> Format</option>
                    <option> GeoJSON</option>
                    <option> GPX</option>
                    <option> KML</option>
                  </select>
                </div>
                <div class="form-group" id="projection">
                  <label> Système de Référence Spatiale</label>
                  <select class="form-control" id="srs" name="srs">
                    <option style="display: none;"> SRS</option>
                  </select>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-danger pull-left" data-dismiss="modal" data-toggle="tooltip" data-original-title="Annuler"><i class="fa fa-times"></i></button>
              <button type="button" class="btn btn-primary" onClick="getFeatureContent( this )" data-toggle="tooltip" data-original-title="Terminer"><i class="fa fa-check"></i></button>
            </div>
          </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
      </div><!-- /.modal#publisher-local --> 

      <!-- Modal - Save personal's project -->
      <div class="modal fade" id="publisher-personal">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              <h4 class="modal-title"> </h4>
            </div>
            <div class="modal-body"> 
              <form role="form">
                <div class="form-group" id="filename">
                  <label> Nom du projet</label>
                  <input type="text" class="form-control" name="filename" maxlenght="15" placeholder="Fichier">
                </div> 
                <div class="form-group" id="personal-comments" name="comments">
                  <label> Commentaire ( <small class="text-counter">200</small> )</label>
                  <textarea class="textarea" placeholder="Ajoutez un bref commentaire. " style="width: 100%; height: 100px; font-size: 14px; line-height: 18px; border: 1px solid #dddddd; padding: 10px;" maxlength="200" oninput="textCounter( this )"></textarea> 
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-danger pull-left" data-dismiss="modal" data-toggle="tooltip" data-original-title="Annuler"><i class="fa fa-times"></i></button>
              <button type="button" class="btn btn-primary" onClick="getFeatureContent( this )" data-toggle="tooltip" data-original-title="Terminer"><i class="fa fa-check"></i></button>
            </div>
          </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
      </div><!-- /.modal#publisher-personal --> 


      <!-- Modal - Update project's comments -->
      <div class="modal fade" id="project-comments">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-body"> 
              <form role="form">
                <div class="form-group" id="project-comments" name="comments">
                  <label> Commentaire ( <small class="text-counter">200</small> )</label>
                  <textarea class="textarea" placeholder="Ajoutez un bref commentaire. " style="width: 100%; height: 100px; font-size: 14px; line-height: 18px; border: 1px solid #dddddd; padding: 10px;" maxlength="200" oninput="textCounter( this )"></textarea> 
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-danger pull-left" data-dismiss="modal" data-toggle="tooltip" data-original-title="Annuler"><i class="fa fa-times"></i></button>
              <button type="button" class="btn btn-primary" onClick="setComments( this )" data-toggle="tooltip" data-original-title="Terminer"><i class="fa fa-check"></i></button>
            </div>
          </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
      </div><!-- /.modal#publisher-personal --> 


      <!-- Modal - Load project's feature params' window -->
      <div class="modal fade" id="load-project">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              <h4 class="modal-title"> </h4>
            </div>
            <div class="modal-body"> 
              <form role="form">
                <div class="form-group" id="project-list">
                  <label> Liste des projets disponibles</label>
                  <select class="form-control" id="project" name="project">
                    <option style="display: none;"> Projets disponibles</option>
                  </select>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-danger pull-left" data-dismiss="modal" data-toggle="tooltip" data-original-title="Annuler"><i class="fa fa-times"></i></button>
              <button type="button" class="btn btn-primary" data-toggle="tooltip" data-original-title="Terminer" onClick="loadProject( this )"><i class="fa fa-check"></i></button>
            </div>
          </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
      </div><!-- /.modal#marker-group-editor -->


      <div class="modal fade" id="marker-label-editor">
        <div class="modal-dialog modal-sm">
          <div class="modal-content">
            <div class="modal-body"> 
              <form role="form">
                <div class="form-group" id="feature-type">
                  <label> Type d'entite&#769</label>
                  <select class="form-control" id="feature-type" onchange="setFeatureType( this )">
                    <option geom="all" type="defaut" value="De&#769faut"> De&#769faut</option>
                    <option geom="point" type="achat" value="Poste d\&#39;achat"> Poste d'achat</option>
                    <option geom="point" type="validation" value="Validation"> Validation</option>
                    <option geom="linestring" type="chemin" value="Chemin d\&#39;accès"> Chemin d'accès</option>
                    <option geom="polygon" type="site" value="Site d\&#39;exploitation"> Site d'exploitation</option>
                  </select>
                </div>
                <div class="form-group" id="feature-name">
                  <label> Nom de l'entite&#769</label>
                  <input type="text" class="form-control" name="Nom" placeholder="Nom">
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-danger pull-left" data-dismiss="modal" data-toggle="tooltip" data-original-title="Annuler"> 
                <i class="fa fa-times"></i>
              </button>
              <button type="button" class="btn btn-primary" onClick="setFeatureLabel( this )" data-dismiss="modal" data-toggle="tooltip" data-original-title="Terminer"> 
                <i class="fa fa-check"></i>
              </button>
            </div>
          </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
      </div><!-- /.modal#marker-group-editor -->

      <div class="modal fade" id="marker-style-editor">
        <div class="modal-dialog modal-sm">
          <div class="modal-content">
            <div class="modal-body"> 
              <form role="form">
                <div class="form-group" id="fill">
                  <label> Couleur de l'entite&#769</label>
                  <div class="input-group my-colorpicker" id="fill">
                    <input type="text" class="form-control">
                    <div class="input-group-addon">
                      <i></i>
                    </div>
                  </div><!-- /.input group -->
                </div><!-- /.form group -->
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-danger pull-left" data-dismiss="modal" data-toggle="tooltip" data-original-title="Annuler"> 
                <i class="fa fa-times"></i>
              </button>
              <button type="button" class="btn btn-success pull-left" data-dismiss="modal" data-toggle="tooltip" data-original-title="Re&#769initialiser" onClick="resetFeatureStyle( this )">
                <i class="fa fa-refresh"></i>
              </button>
              <button type="button" class="btn btn-primary" data-dismiss="modal" data-toggle="tooltip" data-original-title="Sauvegarder" onClick="setFeatureStyle(this)">
                <i class="fa fa-check"></i>
              </button>
            </div>
          </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
      </div><!-- /.modal#marker-group-editor --> 

      <div class="modal fade" id="marker-valid-blueberry">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-body"> 
              <form role="form">

                <div class="row" id="general">
                  <div class="col-xs-10 col-xs-offset-1">
                    <h3 class="row-title">Ge&#769ne&#769ral</h3>
                  </div>
                  <div class="col-xs-8 col-xs-offset-2">
                    <div class="form-group" id="no_hsi">
                      <label> # IQH </label>
                      <select class="form-control" name="no_hsi" section="iqh">
                        <option value="">IQH</option>
                      </select>
                    </div>
                  </div>
                  <div class="col-xs-8 col-xs-offset-2">
                    <div class="form-group" id="forest_stand">
                      <label> Peuplement d&#39origine</label>
                      <input type="text" class="form-control" name="forest_stand" maxlength="25" placeholder="Peuplement">
                    </div>
                  </div>
                </div><!-- /.row#general -->

                <div class="row" id="blueberry">
                  <div class="col-xs-10 col-xs-offset-1">
                    <h3 class="row-title">Bleuet sauvage</h3>
                  </div>
                  <div class="col-xs-8 col-xs-offset-2">
                    <div class="form-group" id="bluerry-cover">
                      <label> Recouvrement </label>
                      <select class="form-control" name="bluerry_cover" section="cover">
                        <option value="">Valeur (%)</option>
                      </select>
                    </div>
                  </div>
                  <div class="col-xs-8 col-xs-offset-2">
                    <div class="form-group" id="blueberry-fruits">
                      <label> Fleurs - Fruits </label>
                      <select class="form-control" name="blueberry_fruits">
                        <option value="">Valeur (qlte)</option>
                        <option value="faible">Faible</option>
                        <option value="moyen">Moyen</option>
                        <option value="fort">Fort</option>
                      </select>
                    </div>
                  </div>
                  <div class="col-xs-8 col-xs-offset-2">
                    <div class="form-group" id="blueberry-potential">
                      <label> Productivite&#769 </label>
                      <select class="form-control" name="blueberry_potential">
                        <option value="">Valeur (qlte)</option>
                        <option value="faible">Faible</option>
                        <option value="moyen">Moyen</option>
                        <option value="eleve">E&#769leve&#769</option>
                      </select>
                    </div>
                  </div>
                </div><!-- /.row#blueberry -->

                <div class="row" id="competition">
                  <div class="col-xs-10 col-xs-offset-1">
                    <h3 class="row-title">Compe&#769tition</h3>
                  </div>
                  <div class="col-xs-10 col-xs-offset-2">
                    <div class="form-group" id="competition-herbaceous">
                      <label> Strate herbace&#769e </label>
                      <div class="form-inline" id="herbaceous-layer" name="species-1">
                        <select class="form-control" name="herbaceous_name_1" section="essence"> 
                          <option value="">1ere espe&#768ce</option>
                        </select>
                        <select class="form-control" name="herbaceous_cover_1" section="cover">
                          <option value="">Recouvrement</option>
                        </select>
                      </div> 
                      <div class="form-inline" id="herbaceous-layer" name="species-2">
                        <select class="form-control" name="herbaceous_name_2" section="essence">
                          <option value="">2e espe&#768ce</option>
                        </select>                        
                        <select class="form-control" name="herbaceous_cover_2" section="cover">
                          <option value="">Recouvrement</option>
                        </select>
                      </div> 
                      <div class="form-inline" id="herbaceous-layer" name="species-3">
                        <select class="form-control" name="herbaceous_name_3" section="essence">
                          <option value="">3e espe&#768ce</option>
                        </select>                        
                        <select class="form-control" name="herbaceous_cover_3" section="cover">
                          <option value="">Recouvrement</option>
                        </select>
                      </div> 
                      <div class="form-inline" id="herbaceous-layer" name="species-4">
                        <select class="form-control" name="herbaceous_name_4" section="essence">
                          <option value="">4e espe&#768ce</option>
                        </select>                        
                        <select class="form-control" name="herbaceous_cover_4" section="cover">
                          <option value="">Recouvrement</option>
                        </select>
                      </div> 
                    </div>
                  </div>
                  <div class="col-xs-10 col-xs-offset-2">
                    <div class="form-group" id="competition-shrubby">
                      <label> Strate arbustive </label>
                      <div class="form-inline" id="shrub-layer" name="species-1">
                        <select class="form-control" name="shrub_name_1" section="essence">
                          <option value="">1ere espe&#768ce</option>
                        </select>                        
                        <select class="form-control" name="shrub_cover_1" section="cover">
                          <option value="">Recouvrement</option>
                        </select>
                        <select class="form-control" name="shrub_height_1" section="height">
                          <option value="">Hauteur</option>
                        </select>
                      </div> 
                      <div class="form-inline" id="shrub-layer" name="species-2">
                        <select class="form-control" name="shrub_name_2" section="essence">
                          <option value="">2e espe&#768ce</option>
                        </select>                         
                        <select class="form-control" name="shrub_cover_2" section="cover">
                          <option value="">Recouvrement</option>
                        </select>
                        <select class="form-control" name="shrub_height_2" section="height">
                          <option value="">Hauteur</option>
                        </select>
                      </div> 
                      <div class="form-inline" id="shrub-layer" name="species-3">
                        <select class="form-control" name="shrub_name_3" section="essence">
                          <option value="">3e espe&#768ce</option>
                        </select>                         
                        <select class="form-control" name="shrub_cover_3" section="cover">
                          <option value="">Recouvrement</option>
                        </select>
                        <select class="form-control" name="shrub_height_3" section="height">
                          <option value="">Hauteur</option>
                        </select>
                      </div> 
                      <div class="form-inline" id="shrub-layer" name="species-4">
                        <select class="form-control" name="shrub_name_4" section="essence">
                          <option value="">4e espe&#768ce</option>
                        </select>                         
                        <select class="form-control" name="shrub_cover_4" section="cover">
                          <option value="">Recouvrement</option>
                        </select>
                        <select class="form-control" name="shrub_height_4" section="height">
                          <option value="">Hauteur</option>
                        </select>
                      </div> 
                    </div>
                  </div>
                </div><!-- /.row#competition -->

                <div class="row" id="cover">
                  <div class="col-xs-10 col-xs-offset-1">
                    <h3 class="row-title">Couvert forestier</h3>
                  </div>
                  <div class="col-xs-8 col-xs-offset-2">
                    <div class="form-group" id="cover-density">
                      <label> Densite&#769 du couvert</label>
                      <select class="form-control" name="cover_density" section="density">
                        <option value="">Densite&#769 (%)</option>
                      </select>
                    </div>
                  </div>
                  <div class="col-xs-8 col-xs-offset-2">
                    <div class="form-group" id="cover-height">
                      <label> Hauteur des arbres (~) </label>
                      <select class="form-control" name="cover_height" section="trees">
                        <option value="">Hauteur (m)</option>
                      </select>
                    </div>
                  </div>
                </div><!-- /.row#cover -->

                <div class="row" id="comments">
                  <div class="col-xs-10 col-xs-offset-1">
                    <h3 class="row-title">Remarques</h3>
                  </div>
                  <div class="col-xs-10 col-xs-offset-1">
                    <div class="form-group" name="blueberry_comments">
                      <label> Commentaire ( <small class="text-counter">200</small> )</label>
                      <textarea class="textarea" placeholder="Ajoutez un bref commentaire. " style="width: 100%; height: 100px; font-size: 14px; line-height: 18px; border: 1px solid #dddddd; padding: 10px;" maxlength="200" oninput="textCounter( this )"></textarea> 
                    </div>
                  </div>
                </div><!-- /.row#comments -->

              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-danger pull-left" data-dismiss="modal" data-toggle="tooltip" data-original-title="Annuler"> 
                <i class="fa fa-times"></i>
              </button>
              <button type="button" class="btn btn-success pull-left" data-dismiss="modal" data-toggle="tooltip" data-original-title="Re&#769initialiser">
                <i class="fa fa-refresh"></i>
              </button>
              <button type="button" class="btn btn-primary" data-dismiss="modal" data-toggle="tooltip" data-original-title="Sauvegarder" onClick="validForms2featureProperties( this )">
                <i class="fa fa-check"></i>
              </button>
            </div>
          </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
      </div><!-- /.modal#marker-valid-blueberry --> 

      <div class="modal fade" id="marker-valid-forest">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-body"> 
              <form role="form">

                <div class="row" id="general">
                  <div class="col-xs-10 col-xs-offset-1">
                    <h3 class="row-title">Ge&#769ne&#769ral</h3>
                  </div>
                  <div class="col-xs-8 col-xs-offset-2">
                    <div class="form-group" id="no-hsi">
                      <label> # IQH </label>
                      <select class="form-control" name="no_hsi" section="iqh">
                        <option value="">IQH</option>
                      </select>
                    </div>
                  </div>
                  <div class="col-xs-8 col-xs-offset-2">
                    <div class="form-group" id="forest_stand">
                      <label> Peuplement d&#39origine</label>
                      <input type="text" class="form-control" name="forest_stand" maxlength="25" placeholder="Peuplement">
                    </div>
                  </div>
                </div><!-- /.row#general -->

                <div class="row" id="topography">
                  <div class="col-xs-10 col-xs-offset-1">
                    <h3 class="row-title">Parame&#768tres e&#769cologiques</h3>
                  </div>
                  <div class="col-xs-8 col-xs-offset-2">
                    <div class="form-group" id="topography-slope">
                      <label> Topographie</label>
                      <input type="text" class="form-control" name="slope_situation" maxlength="25" placeholder="Situation">
                      <input type="text" class="form-control" name="slope_exposure" maxlength="25" placeholder="Exposition">
                      <input type="text" class="form-control" name="slope_shape" maxlength="25" placeholder="Forme">
                      <input type="text" class="form-control" name="slope_tilt" maxlength="25" placeholder="Inclinaison">
                    </div>
                  </div>
                </div><!-- /.row#topography -->

                <div class="row" id="soil">
                  <div class="col-xs-8 col-xs-offset-2">
                    <div class="form-group" id="soil-drain">
                      <label> Drainage</label>
                      <select class="form-control" name="soil_drain" section="drain">
                        <option value=""> Valeur</option>
                      </select>
                    </div>
                  </div>
                  <div class="col-xs-8 col-xs-offset-2">
                    <div class="form-group" id="soil-texture">
                      <label> Texture</label>
                      <select class="form-control" name="soil_texture" section="depot">
                        <option value=""> Valeur</option>
                      </select>
                    </div>
                  </div>
                </div><!-- /.row#soil -->

                <div class="row" id="disturbance">
                  <div class="col-xs-8 col-xs-offset-2">
                    <div class="form-group" id="disturbance-ground">
                      <label> Perturbation du sol</label>
                      <select class="form-control" name="disturbance_ground" section="disturbance">
                        <option value=""> Valeur</option>
                      </select>
                    </div>
                  </div>
                  <div class="col-xs-8 col-xs-offset-2">
                    <label> A&#770ge de la perturbation </label>
                    <div class="form-group form-inline" id="disruption-source">
                      <label>
                        <input type="radio" name="disruption_source" value="fire" checked>
                        Feux
                      </label>
                      <label>
                        <input type="radio" name="disruption_source" value="woodcutting">
                        Coupe
                      </label>
                    </div>
                  </div>
                  <div class="col-xs-8 col-xs-offset-2">
                    <div class="form-group" id="disturbance-agee">
                      <select class="form-control" name="disturbance_age" section="age">
                        <option value=""> Valeur (an)</option>
                      </select>
                    </div>
                  </div>
                </div><!-- /.row#disturbance -->

                <div class="row" id="forest">
                  <div class="col-xs-8 col-xs-offset-2">
                    <div class="form-group" id="forest-gei">
                      <label> Espe&#768ces indicatrices </label>
                      <input type="text" class="form-control" name="forest_gei" maxlength="25" placeholder="GEI">
                    </div>
                  </div>
                  <div class="col-xs-10 col-xs-offset-2">
                    <div class="form-group" id="forest-ecological-type">
                      <label> Type e&#769cologique</label>
                      <div class="form-inline" id="forest-ecological-type"> 
                        <select class="form-control" name="forest_ecological_type" section="ecological">
                          <option value="">--</option>
                        </select>
                        <select class="form-control" name="first_physical_character" section="first_physical">
                          <option value="">--</option>
                        </select>
                        <select class="form-control" name="second_physical_character" section="second_physical">
                          <option value="">--</option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div><!-- /.row#forest -->

                <div class="row" id="comments">
                  <div class="col-xs-10 col-xs-offset-1">
                    <h3 class="row-title">Remarques</h3>
                  </div>
                  <div class="col-xs-10 col-xs-offset-1">
                    <div class="form-group" name="forest_comments">
                      <label> Commentaire ( <small class="text-counter">200</small> )</label>
                      <textarea class="textarea" placeholder="Ajoutez un bref commentaire. " style="width: 100%; height: 100px; font-size: 14px; line-height: 18px; border: 1px solid #dddddd; padding: 10px;" maxlength="200" oninput="textCounter( this )"></textarea> 
                    </div>
                  </div>
                </div><!-- /.row#comments -->

              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-danger pull-left" data-dismiss="modal" data-toggle="tooltip" data-original-title="Annuler"> 
                <i class="fa fa-times"></i>
              </button>
              <button type="button" class="btn btn-success pull-left" data-dismiss="modal" data-toggle="tooltip" data-original-title="Re&#769initialiser">
                <i class="fa fa-refresh"></i>
              </button>
              <button type="button" class="btn btn-primary" data-dismiss="modal" data-toggle="tooltip" data-original-title="Sauvegarder" onClick="validForms2featureProperties( this )">
                <i class="fa fa-check"></i>
              </button>
            </div>
          </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
      </div><!-- /.modal#marker-group-editor --> 


      <!-- Modal - Load project's feature params' window -->
      <div class="modal fade" id="user-status-managing">
        <div class="modal-dialog modal-xl">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              <h4 class="modal-title"> Gestionnaire de partage </h4>
            </div>
            <div class="modal-body no-padding" style="height:250px;"> 
              <div class="box box-widget" id="user">
                <div class="box-header">
                  <div class="box-tools pull-right">
                    <button class="btn btn-box-tool online" id="refresh-user" name="user" rel="tooltip" data-title="Rafrai&#770chir" onClick="refreshTable( this )">
                      <i class="fa fa-refresh text-green"></i>
                    </button>
                  </div> 
                </div>
                <div class="box-body no-padding text-black" style="height:220px;">
                  <div class="span-12">
                    <table class="table display" cellspacing="0" id="user" width="100%">
                      <thead>
                        <tr>
                          <th>Nom</th>
                          <th>Prénom</th>
                          <th>Courriel</th>
                        </tr>
                      </thead>
                      <tbody>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-danger pull-left" data-dismiss="modal" data-toggle="tooltip" data-original-title="Annuler"><i class="fa fa-times"></i></button>
              <button type="button" class="btn btn-primary" id="share-saved" data-toggle="tooltip" data-original-title="Terminer"><i class="fa fa-check"></i></button>
            </div>
          </div>
        </div>
      </div><!-- /.modal#marker-group-editor -->

    </div><!-- ./wrapper -->

    <!-- jQuery 2.1.4 -->
    <script src="plugins/jQuery/jQuery-2.1.4.min.js"></script>
    <!-- jQuery UI 1.11.4 -->
    <!--script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.4/i18n/jquery-ui-i18n.min.js"></script-->
    <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
    <!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
    <script>
      $.widget.bridge('uibutton', $.ui.button);
    </script>
    <!-- Bootstrap 3.3.5 -->
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <!-- AngularJS 1.4.8 >
    <script src="plugins/angular-1.4.8/angular.min.js"></script-->
    <!-- InputMask -->
    <script src="plugins/input-mask/jquery.inputmask.js"></script>
    <script src="plugins/input-mask/jquery.inputmask.date.extensions.js"></script>
    <script src="plugins/input-mask/jquery.inputmask.extensions.js"></script>
    <!-- daterangepicker -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.2/moment.min.js"></script>
    <script src="plugins/daterangepicker/daterangepicker.js"></script>
    <!-- datepicker -->
    <script src="plugins/datepicker/bootstrap-datepicker.js"></script>
    <!-- bootstrap color picker -->
    <script src="plugins/colorpicker/bootstrap-colorpicker.min.js"></script>
    <!-- Bootstrap WYSIHTML5 -->
    <script src="plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.min.js"></script>
    <!-- DataTables -->
    <script src="plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="plugins/datatables/dataTables.bootstrap.min.js"></script> 
    <!-- SlimScroll 1.3.0 -->
    <script src="plugins/slimScroll/jquery.slimscroll.min.js"></script>
    <!-- ChartJS 1.0.1 -->
    <script src="plugins/chartjs/Chart.min.js"></script>
    <!-- iCheck 1.0.1 -->
    <script src="plugins/iCheck/icheck.min.js"></script>
    <!-- FastClick -->
    <script src="plugins/fastclick/fastclick.min.js"></script>
    <!-- AdminLTE App -->
    <script src="dist/js/app.min.js"></script>
    <!-- OL3 -->
    <!--script src="http://openlayers.org/en/v3.0.0/build/ol.js"></script--> 
    <script> 
      if ( navigator.onLine ) {
        document.write('<script src="http://openlayers.org/en/v3.0.0/build/ol.js">\x3C/script>'); 
      } else {
        document.write('<script src="plugins/ol-3.14.0-dist/ol.js">\x3C/script>'); 
      }
    </script>
    <!-- Google API -->
    <script src="https://www.google.com/jsapi"></script> 
    <!-- Google Maps API -->
    <script src="http://maps.google.com/maps/api/js?v=3&amp;sensor=false"></script> 

    <!-- Map & Layers objects -->
    <script src="dist/js/data_loader.js"></script>
    <script src="dist/js/ol3_object.js"></script>
    <script src="dist/js/draw.js"></script>
    <script src="dist/js/navigator.js"></script>

    <script> 


      /** Bootstrap tooltip */
      var info = $( '#info' );
      info.tooltip( { animation: false, trigger: 'manual', html: true } ); 

      /** Chart.js */
      if ( window.screen.width > 980 ) {  
        var canvas = document.getElementById( "pieChart" ); 
        var ctx = canvas.getContext( "2d" );
        var pieData = [ 
          { value: 0, color: "rgba( 204, 76, 2, 0.7 )", highlight: "#CC4C02", label: "Élevé" }, 
          { value: 0, color: "rgba( 254, 153, 41, 0.7 )", highlight: "#FE9929", label: "Moyen" }, 
          { value: 0, color: "rgba( 254, 217, 142, 0.7 )", highlight: "#FED98E", label: "Faible" }, 
          //{ value: 100, color: "#FEF3DD", highlight: "#FEF3DD", label: "Null" }
        ]; 
        var pieOptions = { 
          segmentShowStroke: true, 
          animationEasing: "easeOutQuart", 
          animationStep: 100, 
          animateRotate: true,
          animateScale: false,
          percentageInnerCutout: 50, 
          //tooltipTemplate: "<%= label %> - <%= value %>%"
        }
        var myChart = new Chart( ctx ); 
        var pieChart = myChart.Doughnut( pieData, pieOptions ); 

        $( ".chart-legend#js-legend" ).append( pieChart.generateLegend() ); 
        pieChart.destroy(); 
        pieChart = myChart.Doughnut( [], pieOptions ); 
      }


      /** 
       * Disaplay layer if the checkbox is checked
       * @params { DOM_element || STRING }
       * @return { --- }
       */
      function layer2show( elem, state ) { 
        var name = ( typeof elem == "object" ) ? $( elem ).attr( "name" ) : elem; 
        map.getLayers().forEach( function( layer ) { 
          if ( layer.get( 'name' ) == name ) layer.set( 'visible', state ); 
        } ); 
      }; /** layer2show() */  


      /** 
       * Replace the existing pieChart by a brand new one
       * @params { ol.feature }
       * @return { --- }
       */
      function setPieChart( feature ) { 
        var myData = [ 
          { value: feature.get( "Eleve" ), color: "#CC4C02", highlight: "#CC4C02", label: "Élevé" }, 
          { value: feature.get( "Moyen" ), color: "#FE9929", highlight: "#FE9929", label: "Moyen" }, 
          { value: feature.get( "Faible" ), color: "#FED98E", highlight: "#FED98E", label: "Faible" }, 
          //{ value: feature.get( "Absent" ), color: "#FEF3DD", highlight: "#FEF3DD", label: "Null" }
        ];

        pieChart.destroy(); 
        pieChart = myChart.Doughnut( myData, pieOptions );  

      } /** setPieChart() */ 


      /** 
       * Define info-tooltip css setting
       * @params { array[] }
       * @retrun { --- }
       */
      function displayFeatureInfo( pixel, type ) {
        info.css( {
          left: pixel[0] + "px",
          top: ( pixel[1] - 15 ) + "px"
        } );
        info.tooltip( "hide" ).tooltip( "show" ); 
      } /** displayFeatureInfo() */


      /** 
       * Define chart data info
       * @params { array[] }
       * @retrun { --- }
       */
      function releaseFeatureInfo( pixel ) { 
        var feature = map.forEachFeatureAtPixel( pixel, function( feature, layer ) { 
          if ( layer !== null && layer.getProperties().hasOwnProperty( "name" ) == true && [ "Feuillets 1:20\'000", "Feuillets 1:50\'000", "Feuillets 1:250\'000" ].indexOf( layer.get( "name" ) ) != -1 ) return feature;  
        } );

        if ( feature !== highlight ) {
          if ( highlight ) { 
            featureOverlay.removeFeature( highlight ); 
            pieChart.destroy(); 
            pieChart = myChart.Doughnut( [], pieOptions ); 
          }
          if ( feature ) { 
            featureOverlay.addFeature( feature ); 
            setPieChart( feature ); 
          } 
          highlight = feature;
        }          

      } /** releaseFeatureInfo() */ 


      map.on( "pointermove", function( evt ) {
        if ( evt.dragging ) return;
        var pixel = map.getEventPixel( evt.originalEvent );
        if ( !window.cordova ) releaseFeatureInfo( pixel, "prod" );
      } ); 


      /** 
       * Arrange modal#message header and core by status 
       * @params { $( elem ) }
       * @return { --- }
       */
      function modalMessages( title, text, status ) {
        var myModal = $( ".modal#messages" ); 
        var myTitle = myModal.find( "*" ).children( ".modal-title" ); 
        var myBody = myModal.find( "*" ).children( ".modal-body" ); 

        if ( myModal.hasClass( "modal-" + status ) ) {
          myModal.removeClass( "modal-" + status )
            .addClass( "modal-" + status ); 
        } else if ( myModal.hasClass( "modal-success" ) ) {
          myModal.removeClass( "modal-success" )
            .addClass( "modal-" + status); 
        } else if ( myModal.hasClass( "modal-warning" ) ) {
          myModal.removeClass( "modal-warning" )
            .addClass( "modal-" + status ); 
        } else if ( myModal.hasClass( "modal-danger" ) ) {
          myModal.removeClass( "modal-danger" )
            .addClass( "modal-" + status ); 
        } else {
          myModal.addClass( "modal-" + status );
        }

        myTitle.html( title ); 
        myBody.html( text ); 
        myModal.modal( "show" ); 
      }


      /** 
       * Validate the messages from post.respsonse
       * @params { JSON }
       */
      function validMessages( data ) {
        if ( data.title !== undefined ) modalMessages( data.title, data.text, data.type ); 
      } /** validMessages() */


      /** 
       * Build div content 
       * @params { JSON }
       */
      function postExist( data ) {
        if ( data.title !== undefined ) modalMessages( data.title, data.text, data.type ); 

        if ( data.panel !== undefined ) { 
          for ( var i in data.panel ) {
            var panel = data.panel[i]; 

            if ( panel.node !== undefined ) { 
              indentDiv[ panel.action ]( panel ); 
              if ( panel.after !== undefined ) resetMarkerPanel(); 
              if ( panel.responsive !== undefined ) {
                // Destroy the panel if the resolution is over PX values
                //if ( screen.width < panel.resolution ) indentDiv[ panel.responsive ]( panel ); 
              }
            }
          }
        }

        if ( data.operator !== undefined ) {
          if ( data["operator"] === "login" ) {
            getNotice(); 
          } else if ( data.operator === "local" ) {
            var link = document.createElement("a");
            link.href = data.href; 
            link.download = data.download;
            link.target = "_blank"; 
            link.click();
          } else if ( data.operator == "getAll" ) {
            var table = evalDataTable( $( data.table ) ); 

            table.clear().draw(); 
            for ( var i in data.list ) {
              var value = [ data.list[i].last_name, data.list[i].first_name, data.list[i].email, data.list[i].id ]; 
              table.row.add( value )
                .draw( false );
            }
          }

          if ( data.method !== undefined ) {
            if( data.method === "export" ) {
              resetDraw(); // If the project have been created, than draw vector layer have to be reset 
            } else if ( data.method === "load" ) {
              var hex = randomHEX(); // create a random color to identifying the project when a feature is selected
              layer2list( data, hex ); 
              layer2map( data, hex ); 
            }
          }

        } else if ( data.operator === undefined && data.method !== undefined ) {
          if ( data.method === "list" ) {
            if ( data.list !== undefined ) {
              projectStore( data.list ); 
            }
          } 
        }

      } /* postExist() */


      /** 
       * Get & valid value from php  
       * @params {JSON}
       */
      function postSuccess( data ) {
        var response = $.parseJSON( data ); 
        ( response.exist ) ? postExist( response ) : validMessages( response ); 
      }


      /** 
       * Get & valid value from php  
       * @params {JSON}
       */
      function postError( data ) {
        var type = "danger"; 
        var title = "Connexion e&#769choue&#769e"; 
        var text = "Une erreur interne s\'est de&#769clare&#769e. <br> Il est possible que votre signal Internet limite les e&#769changes de donne&#769es. <br> Si cela perdure, veuillez svp re&#769essayer plus tard."; 
        modalMessages( title, text, type ); 
      }


      /** 
       * Verify if information is in SQLite database 
       * @params { STRING, STRING, function }
       * @return { --- }
       */
      function submitValues( obj, file ) {
        $.post( url.file( url.php(), file ), obj )
          .success(function( data ) { postSuccess( data ) }) 
          .error(function( data ) { postError( data ) }); 
      } /** submitValues() */


      /** 
       * Verify if User can be log or not - Ajax login function with callback action
       * @params { $( elem ) } 
       * @return { --- }
       */
      function userLogin( elem ) {
        var form = $(elem).parents(".user-body").children("form"); 
        var values = form.serialize()+"&type=original"; 

        submitValues( values, "login.php" ); 
      } /** userLogin() */ 


      /** 
       * Reset index.html url
       * @params { --- } 
       * @return { --- }
       */
      function userLogout() {
        var results = document.URL.substring( 0, document.URL.lastIndexOf("/") ); 
        if ( results.indexOf( "?" ) > -1 ) results = results.split( "?" )[0]; 

        return results; 
      }

      /** 
       * Verify if User possess notices. 
       * @params { STRING }
       * @return { --- }
       */
      function getNotice( obj ) {
        var email = $( ".user-image" ).attr( "user" ); 
        var values = ( obj === undefined ) ? { email: email } : { email: email, id: obj }; 

        submitValues( values, "notice.php" ); 
      } /** getNotice() */ 


      /** 
       * Adjust map size to div.content-wrapper 
       * @params { --- }
       * @return { --- }
       */
      function mapSizeContent() {
        var height = $( ".content-wrapper" ).css( "height" ); 
        $( ".row-fluid .span12" ).css( "height", height ); 
        map.updateSize(); 
      } /** mapizeContent() */


      /* 
       * Change the display of obj online class
       * @params { $( elem ), BOOL }
       * @return { --- }
       */
      function obj2connection( elem, bool ) {
        if ( $( elem ).is( "li" ) ) {
          ( bool ) ? $( elem ).show( "500" ) : $( elem ).hide( "500" ); 
        } else if ( $( elem ).is( "button" ) || $( elem ).is( "input" ) || $( elem ).is( "select" ) || $( elem ).is( "span" ) ) {
          $( elem ).prop( "disabled", !bool ); 
        } else if ( $( elem ).is( ".input-group" ) ) {
          $( elem ).children().each( function() {
            obj2connection( $( this ), bool ); 
          } )
        }
      } /* obj2connection() */


      /*
       * Set the last iqh layer up to thematic panel
       * @params { BOOL }
       * @return { --- }
       */
      function layer2display( bool ) {
        var thematic = $( "div.form-group#thematic" ); 
        var list = [ "pfnl", "espece", "iqh" ]; 
        if ( bool ) {  
          if ( thematic.attr( "iqh" ) ) { 
            for ( var i in list ) {
              $( "select#" + list[i] ).val( thematic.attr( list[i] ) ).trigger( "change" ); 
            }
          } 
        } else {
          if ( !$( "a.clear-hsi" ).hasClass( "hidden" ) ) { 
            for ( var i in list ) { 
              thematic.attr( list[i], $( "select#" + list[i] ).val() ); 
            }
            $( "a.clear-hsi" ).click(); 
            $( "select#pfnl" ).prop( "disabled", true ); 
          }
        }
      } /* layer2display() */ 


      
      function status2display( obj, theme, text ) {
        var icon = $( "<i/>" ).addClass( "fa fa-circle text-" + theme ); 
        var href = $( "<a href=\"#\"/>" ).append( icon, [ text ] ); 

        indentDiv.replaceWith( { last: obj, html: href } ); 
      } /* status2display() */


      /**
       * Do jobs that have to be done after document render
       * @params { --- }
       * @return { --- }
       */
      $( function() {

        String.prototype.replaceAll = function(search, replacement) {    
          var target = this;   
          return target.split(search).join(replacement);
        }; 


        var referrer = ( [ document.URL.substring( 0, document.URL.lastIndexOf("/") ), "dist/json/projection.json" ] ).join( "/" );
        $.get( referrer, srsStore ); 

        var referrer = ( [ document.URL.substring( 0, document.URL.lastIndexOf("/") ), "dist/json/validation.json" ] ).join( "/" );
        $.get( referrer, validationStore );


        if ( $(".user-image").attr("user") !== undefined ) {
          var myData = { user: $(".user-image").attr("user"), method: "list" }; 
          submitValues( myData, "export.php" ); 
        }


        /** Set map size **/
        mapSizeContent();  
        /** Listen for orientation changes **/
        window.addEventListener( "orientationchange", function() {
          mapSizeContent(); 
        }, false);


        /** Load IQH from SQLiteDB */
        getIqh(); 


        /** Remove Pinch( mobile device only ) Interaction */
        var map_interactions = map.getInteractions().getArray();
        var list_interaction = [ "PinchRotate", "PinchZoom" ]; 
        for ( var i in list_interaction ) {
          var tmp_interaction = map_interactions.filter( function( interaction ) {  return interaction instanceof ol.interaction[ list_interaction[i] ]; } )[0];
          map.removeInteraction( tmp_interaction ); 
        }


        /** Valid if user email is pass in argument */
        var parameters = location.search.replace( "?", "" ); 
        var values = parameters + "&type=original";
        if ( parameters != "" ) submitValues( values, "valid_user.php" ); 


        /** Verify if user's notices from SQLiteBD are available every 60 sec **/
        setInterval( function() { 
          if ( $(".user-image").attr("user") !== undefined && navigator.onLine ) {
            getNotice(); 
          }
        }, 30000 ); /** VALIDE USER'S NOTICE **/


        /** Verify if Internet connection is true **/
        setInterval( function () {
          var info = $( ".user-panel div.info a" ); 
          var panel = $( ".user-panel" )

          if ( navigator.onLine && info.children( "i.fa" ).hasClass( "text-danger" ) ) {
            if ( panel.attr( "id" ) == "login" && !info.children( "i.fa" ).hasClass( "text-success" ) ) {
              status2display( info, "success", panel.attr( "status" ) ); 
            } else if ( panel.attr( "id" ) == "logout" && !info.children( "i.fa" ).hasClass( "text-yellow" ) ) {
              status2display( info, "yellow", "Déconnecté" );                
            }

            layer2display( navigator.onLine ); 
            panel.attr( "online", navigator.onLine );  
            $( ".icheckbox_line-blue" ).toggleClass( "disabled" ); 
            $( ".online" ).each( function() { obj2connection( this, navigator.onLine ) } ); 

          } else if ( !navigator.onLine && !info.children( "i.fa" ).hasClass( "text-danger" ) ) { 
            status2display( info, "danger", "Hors réseaux" ); 

            panel.attr( "online", navigator.onLine ); 
            layer2display( navigator.onLine ); 
            $( ".icheckbox_line-blue" ).toggleClass( "disabled" ); 
            $( ".online" ).each( function() { obj2connection( this, navigator.onLine ) } ); 

          } 

        }, 250); /** INTERNET CONNECTION VALIDATION **/


        $( "input[type='radio']" ).each( function() {
          $( this ).iCheck( {
            radioClass: 'iradio_flat-blue'
          } );
        } ); 

        /** Hide delete feature button **/
        $(".check").fadeOut(); 
        disabledEvt( $( "select#espece" ), true ); 
        disabledEvt( $( "select#iqh" ), true ); 


        /** Stop-interaction global managment **/
        $(".stop-interaction").fadeOut()
          .click(function() {
            $(this).fadeOut(500); 
            removeInteraction(); 
            resetMarkerPanel();  
        });   

        // witch is for element with data-toggle already set
        $("[rel='tooltip']").tooltip();

        // Colorpicker plugin setting
        $(".my-colorpicker").each(function() {
          $(this).colorpicker({format : 'rgba'});
        }); 


        // iCheck - Line plugin setting
        $( 'input.line-layer-selector' ).each( function() {
          var self = $(this),
            label = self.next(),
            label_text = label.text();

          label.remove();
          self.iCheck({
            checkboxClass: 'icheckbox_line-blue',
            radioClass: 'iradio_line-blue',
            insert: '<div class="icheck_line-icon"></div>' + label_text
          });

          self.on('ifChecked', function() {
            layer2show(this, true);
          });

          self.on('ifUnchecked', function() {
            layer2show(this, false);
          });

        }); 

      } ); /* $.onLoad() */


      function removeInteraction() { 
        sketch=null; 
        for (evt in interaction) {
          tmp = interaction[evt]
          map.removeInteraction(tmp); 
        }
      }; 


      /**
       * Stop all interaction from draw.js
       * @params {.li#id ==vector[name], feature display}
       */
      function stopInteraction( class_name, evt ) {
        $(".stop-interaction").fadeIn(500)
          .click(function() {

            removeInteraction(); 
            resetMarkerPanel();  
            map.on('pointermove', function(evt) {
              info.tooltip('hide');
            });

            if (evt == 'clear') {
              try {
                vector[class_name].getSource().clear(); 
              } catch(err) {
                console.log(err); 
              }
            }
          });
      }; 


      /**
       * Retrun values of a form 
       * @params {<form>}
       * @return {array[]}
       */
      function getFormContent( elem ) {
        var form = ( $( elem ).is( "form" ) ) ? elem : $( elem ).parents( ".modal-content" ).find( "form" ); 
        var results = form.serializeArray(); 
        
        form.find( ".form-group" ).each( function() {
          name = $( this ).attr( "name" ); 
          if ( name ) {
            if( name.indexOf( "comments" ) !== -1 ) {
              results.push( { name: name, value: $( this ).children( "textarea" ).val().replaceAll("'", "\\'") } );
            } 
          }
        } ); 
        form[0].reset(); 

        return results; 
      } /** getFormContent() */


      function getSelectedFeature() {
        var fid = $( ".box#feature-info tr#fid td#info" ).html(); 
        var layer = layer2draw(); 
        var source = getLayerSource( layer.layer ); 
        var feature = source.getFeatureById( fid ); 
        var geom = feature.getGeometry().getType(); 

        return { fid: fid, layer: layer, source: source, feature: feature, geom: geom }; 
      }


      function setModalLabel( elem ) {
        var options = $( ".modal#marker-label-editor form div#feature-type select option" ); 
        var feature = getSelectedFeature(); 

        for ( var i = 0; i < options.length; i++ ) {
          $( options[i] ).removeAttr( "style" );
          if ( $( options[i] ).attr( "geom" ) != "all" && $( options[i] ).attr( "geom" ) != feature.geom.toLowerCase() ) {
            $( options[i] ).css( "display", "none" ); 
          } 
        }

        $( "select#feature-type" ).val( $( "select#feature-type option:first" ).val() );
        $( ".modal#marker-label-editor" ).modal().show(); 

      } /* setModalLabel() */  


      /**
       * Set the group's type depending of the selected option
       * @params { array[] }
       * @return { --- }
       */
      function setFeatureType( elem ) {
        var option = $( ".modal#marker-label-editor form div#feature-type select option:selected" ); 
        var input = $( ".modal#marker-label-editor div.form-group#feature-name input"); 
        var feature = getSelectedFeature();  

        ( option.attr( "type" ) != "defaut" ) ? input.prop( "disabled", true ) : input.prop( "disabled", false ); 
        feature.feature.setProperties( { status: option.attr( "type" ) } ); 

      } /* setFeatureType() */


      /**
       * Return values of a form 
       * @params { array[] }
       * @return { --- }
       */
      function setFeatureLabel( elem ) {
        var type = $( ".modal#marker-label-editor form div#feature-type select option:selected");  
        var name = ( type.attr( "type" ) != "defaut" ) ? type.val() : $( ".modal#marker-label-editor div.form-group#feature-name input").val().replaceAll( "'", "\'" );  
        var feature = getSelectedFeature(); 

        $( ".box#feature-info tr#group td#info" ).html( type.val().replaceAll("\\", "") ); 
        $( ".box#feature-info tr#label td#info" ).html( name.replaceAll("\\", "") ); 

        feature.feature.setProperties( { name: name } ); // set feature's name

      } /** setFeatureGroup() */


      /**
        * Build ol.style.Style from colorPicker value 
        * @params {<button />}
        */
      function setFeatureStyle( elem ) {
        var feature = getSelectedFeature(); 
        var color = $(".modal#marker-style-editor .my-colorpicker input").val();   

        style2feature( feature.feature, color ); 

      } /** setFeatureStyle() */ 


      /**
       * Force featurecolor to look like projectcolor
       * @params { $( elem ) }
       * @return { --- }
       */
      function resetFeatureStyle( elem ) {
        var feature = getSelectedFeature();  

        style2feature( feature.feature ); 
      } /* resetFeatureStyle() */


      /**
       * Set ol3 style 
       * @params { ol.feature, rgba( r, g, b, o ) }
       * @return { --- }
       */
      function style2feature( feature, color ) {
        var span = $( ".box#feature-info tr#style td#info span" ); 
        var hex = ( color ) ? rgb2hex( color ) : rgb2hex( feature.getProperties().projectcolor ); 
        var rgba =  hex2rbga( hex, 0.2 ); 
        var yiq = getContrastYIQ( hex, "rgba" ); 

        ( color ) ? feature.setProperties( { featurecolor: hex } ) : feature.setProperties( { featurecolor: null } );  
        span.css( "background-color", hex ); 
        span.css( "color", yiq["fill"] ); 

      } /* style2feature() */


      /* 
       * Get the drawed layer's name 
       * @params { --- }
       * @return { --- }
       */
      function layer2draw() {
        var results = {}; 
        var draw = $( "ul.treeview-menu#draw" ); 
        
        results.name = draw.attr( "layer_name" );
        results.id = draw.attr( "layer_id" ); 
        results.layer = ( results.name == "draw" ) ? "draw" : [ results.name, results.id ].join( "_" ); 

        return results; 
      } /* layer2draw() */


      /**
       * Get user input and send it to the specific exporting function
       * @params { hmtlNode }
       * @return { --- }
       */
      function getFeatureContent( elem ) {
        var parent = $( elem ).parents( ".modal" ); 
        var form = getFormContent( elem ); 
        var results = { date: new Date().toLocaleDateString(), user: $( ".user-image" ).attr( "user" ), method: "export", type: parent.attr( "id" ).replace( "publisher-", "" ) }; 

        for ( var i in form ) {
          var key = form[i].name; 
          var val = form[i].value; 

          results[key] = val; 
        } 

        if ( results.type != "local" ) { // User can only export the original project to PostgreSQL
          results["layer"] = "draw"; 
          results["extension"] = "GeoJSON"; 
          results["srs"] = "4326"; 
        } else { // User can export any project on his computer
          results["filename"] = layer2draw().layer; 
          results["layer"] = layer2draw().layer; 
        }

        exportFeature( results ); 
        parent.modal( "hide" ); 

      } /** getFeatureContent() */ 


      /**
       * Add or remove select's options 
       * @params { STRING, STRING, BOOL }
       * @return { --- }
       */
      function displayOption( select, name, id, bool ) {
        select = $( "select#"+ select +" option[name='"+ name +"'][id='"+ id +"']" ); 

        if ( bool ) {
          select.removeAttr( "style" ); 
        } else {
          select.css( "display", "none" ); 
        }
      } /* displayOption() */


      /**
       * Get user input and send it to the specific exporting function
       * @params { hmtlNode }
       * @return { --- }
       */
      function loadProject( elem ) {

        /* 
         * Translate the label group from SQLiteDB values
         * @params { STRING }
         * @return { STRING }
         */
        function changeLabel( obj ) {
          var results = ( obj == "Partage" ) ? "share" :  
            ( obj == "Personnel" ) ? "personal" : 
            ( obj == "Publique" ) ? "public" : 
            obj; 

          return results; 
        } /* changeLabel() */


        var form = $( "div.modal#load-project .modal-body form" ); 
        var option = $( "div.modal#load-project .modal-body form select option:selected" ); 
        var label = changeLabel( option.parent( "optgroup" ).attr( "label" ) ); 
        var name = option.attr( "name" ); 
        var id = option.attr( "id" ); 
        var myData = { file: name, method: "load", user: $(".user-image").attr("user"), id: id, type: label }; 

        form[0].reset();
        displayOption( "project", name, id, false ); 
        submitValues( myData, "export.php" ) 
        $( "div.modal#load-project" ).modal( "hide" );  
      } /* loadProject() */ 


      /** 
       * Eval if table object is a DataTable();  
       * @params { $( elem ) }
       * @return { $( elem ) }
       */
      function evalDataTable( elem ) { 
        var id = $( elem ).attr( "id" ); 
        var params = { "scrollY": "100px", "scrollCollapse": true, "autoWidth": false, "paging": false, "lengthChange": false, "searching": false, "ordering": true, "info": false, "select": true }; 
        if ( id == "load" ) {
          params.columnDefs = [ { "className": "dt-center", "width": "15%", "targets": 0 }, { "className": "dt-center", "width": "85%", "targets": 1 } ];
        } else if ( id == "user" ) {
          params.scrollY = "150px"; 
          params.columnDefs = [ { "className": "dt-center", "width": "30%", "targets": 0 }, { "className": "dt-center", "width": "30%", "targets": 1 }, { "className": "dt-left", "width": "40%", "targets": 2 } ];;
        }

        var results = ( $.fn.dataTable.isDataTable( elem ) ) ? $( elem ).DataTable() : $( elem ).DataTable( params ); 

        return results; 
      } /** evalDataTable */ 


      /** 
       * Create the project icon types ;  
       * @params { STRING }
       * @return { --- }
       */
      function setProjectIcon( type ) {
        results = $( "<i/>" ); 
        if ( type == "personal" ) {
          results.addClass( "fa fa-user" ); 
        } else if ( type == "share" ) {
          results.addClass( "fa fa-user-plus" ); 
        } else if ( type == "public" ) {
          results.addClass( "fa fa-users" ); 
        }

        return results; 
      } /* setProjectIcon() */


      /** 
       * Add the load's layer to the project's DataTable();  
       * @params { OBJECT }
       * @return { --- }
       */
      function layer2list( data, color ) { 
        var table = evalDataTable( $( ".table#load" ) ); 
        var values = [ data.id, data.name, data.type, color, data.comments ]; 

        table.row.add( values )
          .draw( false ); 

      } /* layer2list() */ 


      /** 
       * Add the load's layer to map;  
       * @params { OBJECT }
       * @return { --- }
       */
      function layer2map( data, color ) {
        var layer = { type: "vector", title:[ data.name, data.id ].join("_"), source:"geojson", color: color, opacity:1, visible:true, data:data.layer, epsg: 4326 }; 
        var layer = constructor[ layer.type ]( layer ); 

        map.addLayer( layer ); 
      } /* layer2map() */


      /** 
       * Clear the source.Vector named "draw" ;  
       * @params { OBJECT }
       * @return { --- }
       */
      function resetDraw() {
        map.getLayers().forEach( function( e ) {
          if ( e.get( "name" ) == "draw" ) {
            e.getSource().clear();  
          }
        } ); 
      } /* resetDraw() */  


      /** 
       * Text area characters left 
       * @params { $( elem ) }
       * @return { --- }
       */      
      function textCounter( elem ) {
        var parent = $( elem ).parent( "div.form-group" ); 
        var counter = parent.children( "label" ).children( "small.text-counter" );   
        var results = $( elem ).attr( "maxlength" ) - $( elem ).val().length; 
        counter.html( results ); 
      } /* textCounter() */ 


      /** 
       * Modify the project's comments 
       * @params { $( elem ) }
       * @return { --- }
       */
      function setComments( elem ) {
        var index = $( "div.box#load .box-body" ).attr( "index" ); 
        var table = evalDataTable( $( ".table#load" ) ); 
        var form = getFormContent( elem ); 
        var data = table.row( index ).data(); 

        data[4] = form[0].value; 
        table.row( index ).data( data ); 

        $( ".box#comments .box-body p" ).html( ( form[0].value == "" ) ? "..." : form[0].value.replaceAll( "\\", "" ) ); 
        $( elem ).parents( ".modal" ).modal( "hide" ); 
      } /* setComments() */ 


      /**
       * Get the center of a layer extent
       * @params { STRING }
       * @return { ARRAY( coordinates ) }
       */ 
      function extent2center( obj, type ) {
        var results = { name: type, value: [] }; 

        if ( type == "layer" ) {
          map.getLayers().forEach( function( e ) {
            if ( e.get( "name" ) == obj.layer ) {
              var extent = e.getSource().getExtent();  
              if ( extent !== undefined ) results.value = extent; 
            }
          } ); 
        } else if ( type == "feature" ) {
          var extent = obj.getGeometry().getExtent(); 
          if ( extent !== undefined ) {
            results.value[0] = extent[0] + ( extent[2] - extent[0] ) / 2; 
            results.value[1] = extent[1] + ( extent[3] - extent[1] ) / 2; 
          }
        } else if ( type == "coordinates" ) {
          results.value = obj; 
        }

        return results; 
      } /* extent2center() */


      /**
       * Pan and zoom animation from the current view to an other position
       * @params { ARRAY( coordinates ) }
       * @return { --- } 
       */
      function fly2position( coord ) {
        var duration = ( coord.name == "layer" ) ? 2000 : 1000;
        var start = +new Date(); 
        var view = map.getView(); 

        /** @type {ol.animation} */
        var pan = ol.animation.pan( {
          duration: duration,
          source: ( view.getCenter() ), /** @type {ol.Coordinate} */ 
          start: start
        } );

        /** @type {ol.animation} */
        var bounce = ol.animation.bounce( {
          duration: duration,
          resolution: view.getResolution(),
          start: start
        } );

        if ( coord.name == "layer" ) {
          map.beforeRender( pan, bounce ); 
          view.fitExtent( coord.value, map.getSize() ); 
        } else if ( [ "feature", "coordinates" ].indexOf( coord.name ) != -1 ) {
          map.beforeRender( pan ); 
          view.setCenter( coord.value ); 
        }
        
      } /* fly2position() */


      /*
       * Prevents the layers that contain a point feature to enable the bounce function
       * @params { dict{} }
       * @return { dict{} }
       */
      function animation2solve( coord ) {
        var results = coord; 
        var x = results.value[0] - results.value[2]; 
        var y = results.value[1] - results.value[3]; 

        if ( x == 0 && y == 0 ) { 
          results.name = "coordinates"; 
        }

        return results; 
      } /* animation2solve() */


      /**
       * Zoom to layer's extent
       * @params { STRING }
       * @return { --- }
       */
      function zoom2layer( obj, type ) {
        var coord = extent2center( obj, type ); 
        if ( coord !== undefined ) {
          if ( type == "layer" ) {
            coord.type = animation2solve( coord ); 
          }
          fly2position( coord );
        }
      } /* zoom2layer() */ 


      /**
       * Get the valid forms panel values and set theme to the feature properties 
       * @params { $( elem ) }
       * @return { --- }
       */
      function validForms2featureProperties( elem ) {
        var parent = $( elem ).parents( ".modal" ); 
        var form = getFormContent( elem ); 
        var feature = getSelectedFeature(); 

        var properties = {}; 
        for ( var i in form ) {
          var key = form[i].name; 
          var val = form[i].value.replaceAll( "'", "\&#39;" ); 

          properties[key] = val; 
        }

        feature.feature.setProperties( properties ); 

      } /* validForms2featureProperties() */


      /**
       * Get the feature properties and set theme to the valid forms panel values, only if they match
       * @params { $( elem ) }
       * @return { --- }
       */
      function featureProperties2validForms( elem ) {
        var target = $( elem ).attr( "modal-target" ); 
        var modal = $( ".modal#" + target ); 
        var form = modal.find( "form" ); 
        var keys = getFormContent( form ); 
        var feature = getSelectedFeature(); 
        var properties = feature.feature.getProperties(); 

        for ( var i in keys ) {
          var key = keys[i].name; 
          if ( properties[key] ) {
            var value = properties[key].replaceAll( "\&#39;", "\'" ); 

            if ( key.indexOf( "comments" ) != -1 ) {
              form.find( "[name='" + key + "\']" ).children( "textarea" ).val( value.replaceAll( "\\", "" ) ); 
            } else {
              form.find( "[name='" + key + "\']" ).val( value );
            }
          }
        }

        modal.modal( "show" ); 

      } /* featureProperties2validForms() */


      function refreshTable( obj ) {
        // Get the list of all users in sqliteDB
        if ( $( obj ).is( "button" ) ) {
          var parent = $( obj ).parents( ".box" ); 
          var id = parent.attr( "id" );
          var obj = ".table#" + id; 
        } 
        var table = evalDataTable( $( obj ) ); 
        var email = $( ".user-image" ).attr( "user" ); 
        var myData = { email: email, type: "profile", table: obj, methode: "getAll" }; 
        
        table.clear().draw(); 
        submitValues( myData, "getUsers.php" ); 

      } /** refreshTable() **/

    
      /** EVENT - Fire when a navbar element is add to the DOM */ 
      $( "ul.navbar-nav" ).on('DOMNodeInserted', function() { 
       
        $( "div.pull-right#logout" ).children( "a.btn" ).attr( "href", userLogout() ); 

        // Advice - Each time user click on li.message-menu#notification
        // When user click on the last notification, a new empty li.message-menu#notification is create
        // When its the case, all the function put inside those brackets are call back
        if ( $( this ).children( "li.messages-menu#notification" ).length > 0 ) {

          if ( $(".user-image").attr("user") !== undefined ) {
            var myData = { user: $(".user-image").attr("user"), method: "list" }; 
            submitValues( myData, "export.php" ); 
          }
          /**
           * Find json data url, load data, create <select />|< table /> store
           * @params { --- }
           * @return { --- }
           */
          $( "ul.menu" ).children( "li" ).click( function() {
            if ( navigator.onLine ) getNotice( $( this ).attr( "id" ) ); 
            $( this ).remove(); 

            var total = $( "ul.menu" ).children( "li" ).length; 
            var span = $( "li.messages-menu#notification" ).find("*").children( "span.label" ); 
            var header = $( "li.messages-menu#notification" ).find("*").children( "li.header" ); 
            var core = '<li><ul class="menu"><li><a href="#"><h4 style="margin: 0; !important"> Aucun nouvel avis<p class="pull-right"><i class="fa fa-bell text-orange"></i></p></h4><p style="margin: 0; !important"> En attente de nouvels avis</p></a></li></ul></li>'
            if ( total > 0 ) {
              var text = ( total == 1 ) ? [ total, "nouvel avis disponible" ].join( " " ) : [ total, "nouvels avis disponibles" ].join( " " ); 
              span.html( total ); 
            } else {
              var text = "Aucun nouvel avis disponible"; 
              span.remove(); 
              $( core ).insertBefore( $( "li.messages-menu#notification" ).children( "ul.dropdown-menu" ).children( "li.footer") ); 
            }
            header.html( text ); 

          } ); 

        }

      }); 

      $( "div.tab-content" ).on('DOMNodeInserted', function() {

        /** Activate the new tooltip **/
        $( "[rel='tooltip']" ).tooltip();


        /** Block acces to the postionning function if user is on cumputer **/
        if ( !window.cordova ) {
          $( "i.fa.split" ).hide(); 
          $( "button#position" ).hide(); 
        } /** BLOCK MOBILE APPS ON WEB APPS **/


        /** Define the DataTable's params and the user loader function **/
        if ( $( "button#share-project" ).length > 0 ) {

          if ( $.fn.dataTable.isDataTable( $( ".table#user" ) ) ) {
            return 
          } else {

            var table = evalDataTable( $( ".table#user" ) ); 
            table.on( "click", "tr", function() {
              if ( $( this ).hasClass('selected') ) {
                $( this ).removeClass('selected'); 
              } else {
                table.$('tr.selected').removeClass('selected');
                $( this ).addClass('selected'); 

                var data = table.row( this ).data(); 
                $( ".modal#user-status-managing" ).attr( "user", data[3] );  
              }
            } ); 

            // Set user's list from SQLiteDB
            $( "button#share-project" ).click( function() {
              refreshTable( ".table#user" ); 
              $( ".modal#user-status-managing" ).modal( "show" ); 
            } ); 


            $( "button#share-saved" ).click( function() {
              var myModal = $( ".modal#user-status-managing" ); 
              var user = myModal.attr( "user" ); 
              var layer = layer2draw(); 
              var email = $( ".user-image" ).attr( "user" ); 
              var myData = { email: email, user: user, project: layer.id, methode: "share" }; 

              submitValues( myData, "getUsers.php" ); 
              myModal.modal( "hide" ); 
            } ); 


            $( "button#stop-sharing" ).click( function() {
              var myModal = $( ".modal#user-status-managing" ); 
              var layer = layer2draw(); 
              var email = $( ".user-image" ).attr( "user" ); 
              var myData = { email: email, project: layer.id, methode: "unshare" }; 

              submitValues( myData, "getUsers.php" ); 
              myModal.modal( "hide" ); 
            } );

          }

        }


        /** Define the DataTable's params and the project loader function **/
        if ( $( ".table#load" ).length > 0 ) {

          if ( $.fn.dataTable.isDataTable( $( ".table#load" ) ) ) {
            return 
          } else {
            var table = evalDataTable( $( ".table#load" ) );           
            $( "[rel='tooltip']" ).tooltip(); 

            function evalLayerTools( layer, type ) {
              var publish = $( "ul.treeview-menu#publish" ); 
              if ( layer != "draw" ) {
                publish.children().each( function() { 
                  if ( [ "local", "personal" ].indexOf( $( this ).attr( "name" ) ) == -1 ) {
                    $( this ).css( "display", "none" ); 
                  } 
                } ); 

                if ( navigator.onLine ) {
                  $( "button[name='project']" ).prop( "disabled", false ); 
                  $( ".box#comments .box-header button#modify-comments" ).prop( "disabled", false ); 
                  if ( [ "share", "public" ].indexOf( type ) != -1 ) { 
                    $( "button[utility='share']" ).prop( "disabled", true ); 
                  }
                }

              } else {
                publish.children().each( function() { 
                  $( this ).removeAttr( "style" ); 
                } ); 

                if ( navigator.onLine ) {
                  $( "button[name='project']:not(#get-project)" ).prop( "disabled", true ); 
                  $( ".box#comments .box-header button#modify-comments" ).prop( "disabled", true );
                }

              }

            } /* evalLayerTools() */ 


            function setDataInfo( data ) {     
              var footer = $( "div.box#load div.clearfix" ); 
              var tInfo = $( ".project-table-info tr" );  
              var layer = ( data[0] == "0" ) ? "draw" : data[1]; 
              var comments = ( data[4] == "" ) ? "..." : data[4]; 

              evalLayerTools( layer, data[2] ); 

              // update info's form-group label
              for ( var i = 0; i < tInfo.length; i++ ) {
                $( tInfo[i] ).children("td#pId").html( data[0] ); 
                $( tInfo[i] ).children("td#pName").html( data[1] ); 
                indentDiv["replaceWith"]( { 
                  last: $( tInfo[i] ).children("td#pType").children("span").children("i.fa" ), 
                  html: setProjectIcon( data[2] ).addClass( "fa-w" ) 
                } ); 
                $( tInfo[i] ).children("td#pType").children("span").css( "background-color", data[3] )
              }

              // Set project's comments
              $( ".box#comments .box-body p" ).html( comments.replaceAll( "\\", "" ) );            

              // Set layer to draw interaction 
              $( "ul.treeview-menu#draw" ).attr( "layer_name", layer ); 
              $( "ul.treeview-menu#draw" ).attr( "layer_id", data[0] ); 
              $( "ul.treeview-menu#draw" ).attr( "layer_color", data[3] ); 
              $( "a.stop-interaction" ).click(); 

            } /* setDataInfo() */


            /**
             * Diffent action depending on click events
             * @params { STRING, $(elem), $(elem) } 
             * @return { --- }
             */
            function click2table( status, table, tr ) { 
              $( "div.box#load .box-body" ).attr( "index", table.row( tr ).index() );

              if ( $( tr ).hasClass('selected') ) {
                $( tr ).removeClass('selected'); 
              } else {
                table.$('tr.selected').removeClass('selected');
                $( tr ).addClass('selected'); 

                var data = table.row( tr ).data(); 
                setDataInfo( data ); 
                if ( status == "dbclick" ) zoom2layer( layer2draw(), "layer" ); 
              }
            } /* click2table() */ 


            // on double click
            table.on( "click", "tr", function() {
              var $this = $(this);
              if ( $this.hasClass( 'clicked' ) ){
                //alert("Double click"); 
                click2table( "dbclick", table, this ); 
                return;
              } else {
                $this.addClass( 'clicked' );
                click2table( "click", table, this );
                setTimeout(function() { 
                  $this.removeClass( 'clicked' ); 
                }, 1000 );
              }//end of else

            } ); 

  
            // Remove layer from map and table
            $( "button#remove-project" ).click( function() {
              var layer = layer2draw(); 
              var index = $( "div.box#load .box-body" ).attr( "index" ); 
              var data = table.row( 0 ).data(); 

              if ( layer.layer != "draw" ) {
                map.getLayers().forEach( function( e ) {
                  if ( e.get( "name" ) == layer.layer ) {
                    map.removeLayer( e ); 
                  }
                } ); 

                table.row( index )
                  .remove()
                  .draw( false ); 

                setDataInfo( data ); 
                displayOption( "project", layer.name, layer.id, true ); 
              } else {
                resetDraw(); // To clear draw vector layer on user demand
              }

            } ); 


            // Remove layer from map and table
            $( "button#save-project" ).click( function() {
              var layer = layer2draw(); 
              var index = $( "div.box#load .box-body" ).attr( "index" ); 
              var data = table.row( index ).data(); 
              var comments = data[4]; 
              var type = data[2]; 
              var myData = { layer: layer.layer, filename: layer.name, id: layer.id, user: $( ".user-image" ).attr( "user" ), extension: "GeoJSON", srs: "4326", method: "update", comments: comments, type: type }; 

              exportFeature( myData, type, layer.layer );  

            } ); 


            // Zoom to the layer's extent
            $( ".box#project-info button#zoom-project" ).click( function() {
              removeInteraction(); 
              resetMarkerPanel(); 
              zoom2layer( layer2draw(), "layer" ); 
            } ); 


            // Move to feature by ID. ( FID - 1 )
            $( ".box#feature-info button#last-feature" ).click( function() {
              var project = layer2draw(); 
              var source = getLayerSource( project.layer ); 
              var xtrm = getXtrmFid( source ); 
              var fid = $( ".box#feature-info tr#fid td#info" ).html(); 
              var feature; 

              if ( interaction.select == "" ) addFeatureInteraction( "select", layer2draw().layer ); 
              if ( fid == "Identifiant" ) {
                return
              } else {
                fid = parseInt( fid ); 
                if ( fid == xtrm.min ) {
                  feature = source.getFeatureById( xtrm.max ); 
                } else {
                  fid--; 
                  while ( feature === undefined || feature === null ) {
                    feature = source.getFeatureById( fid ); 
                    fid--; 
                  }  
                }
                interaction.select.getFeatures().clear(); 
                interaction.select.getFeatures().push( feature ); // updateMarkerPanel() is a callback function of this method
                zoom2layer( feature, "feature" ); 
              }

            } ); /* .box#feature-info button#last-feature onClick() */


            // Move to feature by ID. ( FID + 1 )
            $( ".box#feature-info button#next-feature" ).click( function() {
              var project = layer2draw(); 
              var source = getLayerSource( project.layer ); 
              var xtrm = getXtrmFid( source ); 
              var fid = $( ".box#feature-info tr#fid td#info" ).html(); 
              var feature; 

              if ( interaction.select == "" ) addFeatureInteraction( "select", project.layer ); 
              if ( fid == "Identifiant" ) {
                return
              } else {
                fid = parseInt( fid ); 
                if ( fid == xtrm.max ) {
                  feature = source.getFeatureById( xtrm.min ); 
                } else {
                  fid++; 
                  while ( feature === undefined || feature === null ) {
                    feature = source.getFeatureById( fid ); 
                    fid++; 
                  }  
                }
                interaction.select.getFeatures().clear(); 
                interaction.select.getFeatures().push( feature ); // updateMarkerPanel() is a callback function of this method
                zoom2layer( feature, "feature" ); 
              }

            } ); /* .box#feature-info button#nextt-feature onClick() */


            layer2list( { id: 0, name: "original", type: "personal", comments: "Donne&#769es originales" }, "#ffcc33" ); 

          }
        } 

        if ( $( "div#comments-box" ).parent( ".slimScrollDiv" ).length > 0 ) {
          return
        } else {
          $( "div#comments-box" ).slimScroll( { height: "100px" } ); 
          $( "[rel='tooltip']" ).tooltip(); 
        }

      } ); 

    </script>

  </body>
</html> 